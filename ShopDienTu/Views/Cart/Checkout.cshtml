@model ShopDienTu.Models.ShoppingCart
@{
    ViewData["Title"] = "Thanh toán";
}

<div class="container">
    <h1 class="mb-4">Thanh toán</h1>

    <div class="row">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Thông tin giao hàng</h5>
                </div>
                <div class="card-body">
                    <form id="checkoutForm" asp-controller="Order" asp-action="PlaceOrder" method="post">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="fullName" class="form-label">Họ tên</label>
                                <input type="text" class="form-control" id="fullName" name="fullName" required 
                                       value="@(User.Identity.IsAuthenticated ? User.FindFirst(System.Security.Claims.ClaimTypes.Name)?.Value : "")">
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Số điện thoại</label>
                                <input type="tel" class="form-control" id="phone" name="phone" required>
                            </div>
                            <div class="col-12">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" required
                                       value="@(User.Identity.IsAuthenticated ? User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value : "")">
                            </div>
                            <div class="col-12">
                                <label for="address" class="form-label">Địa chỉ</label>
                                <input type="text" class="form-control" id="address" name="address" required>
                            </div>
                            <div class="col-md-4">
                                <label for="province" class="form-label">Tỉnh/Thành phố</label>
                                <select class="form-select" id="province" name="province" required>
                                    <option value="">Chọn tỉnh/thành phố</option>
                                    <option value="Hà Nội">Hà Nội</option>
                                    <option value="TP. Hồ Chí Minh">TP. Hồ Chí Minh</option>
                                    <option value="Đà Nẵng">Đà Nẵng</option>
                                    <!-- Add more provinces here -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="district" class="form-label">Quận/Huyện</label>
                                <select class="form-select" id="district" name="district" required>
                                    <option value="">Chọn quận/huyện</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="ward" class="form-label">Phường/Xã</label>
                                <select class="form-select" id="ward" name="ward" required>
                                    <option value="">Chọn phường/xã</option>
                                </select>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h5>Phương thức thanh toán</h5>
                            <div class="payment-methods mt-3">
                                @foreach (var paymentMethod in ViewBag.PaymentMethods)
                                {
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="radio" name="paymentMethodId" 
                                                   id="payment-@paymentMethod.PaymentMethodID" value="@paymentMethod.PaymentMethodID" 
                                        @(paymentMethod.PaymentMethodID == 1 ? "checked" : "")>
                                            <label class="form-check-label" for="payment-@paymentMethod.PaymentMethodID">
                                            @paymentMethod.MethodName
                                            </label>
                                        </div>
                                }
                            </div>
                        </div>

                        <div class="mt-4">
                            <label for="notes" class="form-label">Ghi chú</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Ghi chú về đơn hàng, ví dụ: thời gian hay chỉ dẫn địa điểm giao hàng chi tiết hơn."></textarea>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Đơn hàng của bạn</h5>
                </div>
                <div class="card-body">
                    <div class="order-summary">
                        @foreach (var item in Model.Items)
                        {
                                <div class="d-flex justify-content-between mb-3">
                                    <div>
                                        <span class="fw-bold">@item.ProductName</span>
                                        <div class="text-muted small">@item.Quantity x @string.Format("{0:N0}", item.Price) ₫</div>
                                    </div>
                                    <div class="text-end">
                                    @string.Format("{0:N0}", item.Total) ₫
                                    </div>
                                </div>
                        }
                        <hr>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Tạm tính:</span>
                            <span>@string.Format("{0:N0}", Model.GetTotal()) ₫</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Phí vận chuyển:</span>
                            <span>Miễn phí</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between mb-4">
                            <strong>Tổng cộng:</strong>
                            <strong class="text-danger fs-5">@string.Format("{0:N0}", Model.GetTotal()) ₫</strong>
                        </div>
                        <button type="submit" form="checkoutForm" class="btn btn-primary w-100">
                            <i class="fas fa-check me-2"></i>Đặt hàng
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Sample data for districts and wards - in a real app, this would come from an API
                const locationData = {
                    'Hà Nội': {
                        districts: ['Ba Đình', 'Hoàn Kiếm', 'Hai Bà Trưng', 'Đống Đa', 'Cầu Giấy'],
                        wards: {
                            'Ba Đình': ['Phúc Xá', 'Trúc Bạch', 'Vĩnh Phúc', 'Cống Vị', 'Liễu Giai'],
                            'Hoàn Kiếm': ['Hàng Bạc', 'Hàng Bồ', 'Hàng Đào', 'Hàng Gai', 'Cửa Đông'],
                            'Hai Bà Trưng': ['Nguyễn Du', 'Bách Khoa', 'Phạm Đình Hổ', 'Bạch Mai', 'Thanh Nhàn'],
                            'Đống Đa': ['Cát Linh', 'Văn Miếu', 'Quốc Tử Giám', 'Láng Thượng', 'Ô Chợ Dừa'],
                            'Cầu Giấy': ['Nghĩa Đô', 'Nghĩa Tân', 'Mai Dịch', 'Dịch Vọng', 'Quan Hoa']
                        }
                    },
                    'TP. Hồ Chí Minh': {
                        districts: ['Quận 1', 'Quận 2', 'Quận 3', 'Quận 4', 'Quận 5'],
                        wards: {
                            'Quận 1': ['Bến Nghé', 'Bến Thành', 'Cầu Kho', 'Cầu Ông Lãnh', 'Đa Kao'],
                            'Quận 2': ['An Khánh', 'An Lợi Đông', 'An Phú', 'Bình An', 'Bình Khánh'],
                            'Quận 3': ['Phường 1', 'Phường 2', 'Phường 3', 'Phường 4', 'Phường 5'],
                            'Quận 4': ['Phường 1', 'Phường 2', 'Phường 3', 'Phường 4', 'Phường 5'],
                            'Quận 5': ['Phường 1', 'Phường 2', 'Phường 3', 'Phường 4', 'Phường 5']
                        }
                    },
                    'Đà Nẵng': {
                        districts: ['Hải Châu', 'Thanh Khê', 'Sơn Trà', 'Ngũ Hành Sơn', 'Liên Chiểu'],
                        wards: {
                            'Hải Châu': ['Hải Châu 1', 'Hải Châu 2', 'Thạch Thang', 'Thanh Bình', 'Thuận Phước'],
                            'Thanh Khê': ['An Khê', 'Chính Gián', 'Hòa Khê', 'Tam Thuận', 'Tân Chính'],
                            'Sơn Trà': ['An Hải Bắc', 'An Hải Đông', 'An Hải Tây', 'Mân Thái', 'Nại Hiên Đông'],
                            'Ngũ Hành Sơn': ['Hòa Hải', 'Hòa Quý', 'Khuê Mỹ', 'Mỹ An', 'Mỹ Đa'],
                            'Liên Chiểu': ['Hòa Hiệp Bắc', 'Hòa Hiệp Nam', 'Hòa Khánh Bắc', 'Hòa Khánh Nam', 'Hòa Minh']
                        }
                    }
                };

                const provinceSelect = document.getElementById('province');
                const districtSelect = document.getElementById('district');
                const wardSelect = document.getElementById('ward');

                // Update districts when province changes
                provinceSelect.addEventListener('change', function() {
                    const selectedProvince = this.value;
                    districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
                    wardSelect.innerHTML = '<option value="">Chọn phường/xã</option>';

                    if (selectedProvince && locationData[selectedProvince]) {
                        locationData[selectedProvince].districts.forEach(district => {
                            const option = document.createElement('option');
                            option.value = district;
                            option.textContent = district;
                            districtSelect.appendChild(option);
                        });
                    }
                });

                // Update wards when district changes
                districtSelect.addEventListener('change', function() {
                    const selectedProvince = provinceSelect.value;
                    const selectedDistrict = this.value;
                    wardSelect.innerHTML = '<option value="">Chọn phường/xã</option>';

                    if (selectedProvince && selectedDistrict && 
                        locationData[selectedProvince] && 
                        locationData[selectedProvince].wards[selectedDistrict]) {
                        locationData[selectedProvince].wards[selectedDistrict].forEach(ward => {
                            const option = document.createElement('option');
                            option.value = ward;
                            option.textContent = ward;
                            wardSelect.appendChild(option);
                        });
                    }
                });
            });
        </script>
}
